(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{446:function(e,t,r){Promise.resolve().then(r.bind(r,3352))},3352:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(7437),a=r(1107),u=r(492);function s(e){let{children:t}=e,{loading:r}=(0,a.Q)();return r?(0,n.jsx)(u.h,{}):(0,n.jsx)(n.Fragment,{children:t})}},492:function(e,t,r){"use strict";r.d(t,{g:function(){return u},h:function(){return s}});var n=r(7437),a=r(4508);function u(e){let{className:t,size:r="md"}=e;return(0,n.jsx)("div",{className:(0,a.cn)("flex items-center justify-center",t),children:(0,n.jsx)("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-muted border-t-foreground",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[r])})})}function s(){return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(u,{size:"lg"})})}},2096:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return o},a:function(){return d}});var n=r(7437),a=r(2265),u=r(3301),s=r(4257),i=r(5978);let c=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[d,l]=(0,a.useState)(null),[f,h]=(0,a.useState)(!0),m=async e=>{try{let t=await (0,i.QT)((0,i.JU)(s.db,"users",e));if(t.exists()){let e=t.data();return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}return null}catch(e){return console.error("Error fetching user data:",e),null}};(0,a.useEffect)(()=>{let e=(0,u.Aj)(s.I,async e=>{o(e),e?l(await m(e.uid)):l(null),h(!1)});return()=>e()},[]);let w=async(e,t)=>{try{let r=await (0,u.e5)(s.I,e,t),n=await m(r.user.uid);l(n)}catch(e){throw Error(e.message||"登入失敗")}},p=async(e,t,r)=>{try{let n=await (0,u.Xb)(s.I,e,t),a={uid:n.user.uid,email:e,role:"volunteer",displayName:r.displayName||"",phone:r.phone||"",age:r.age||"",fields:r.fields||[],skills:r.skills||[],availability:r.availability||[],targetAudience:r.targetAudience||[],goals:r.goals,status:"pending",completedTasks:0,createdAt:new Date,updatedAt:new Date};await (0,i.pl)((0,i.JU)(s.db,"users",n.user.uid),{...a,createdAt:new Date,updatedAt:new Date}),n.user&&!n.user.emailVerified&&await (0,u.w$)(n.user),l(a)}catch(e){throw Error(e.message||"註冊失敗")}},g=async()=>{try{await (0,u.w7)(s.I),l(null)}catch(e){throw Error(e.message||"登出失敗")}},v=async e=>{try{await (0,u.LS)(s.I,e)}catch(e){throw Error(e.message||"發送密碼重置郵件失敗")}},y=async(e,t)=>{try{if(!r||!r.email)throw Error("請先登入");let n=u.w9.credential(r.email,e);await (0,u.aF)(r,n),await (0,u.gQ)(r,t)}catch(e){throw Error(e.message||"修改密碼失敗")}};return(0,n.jsx)(c.Provider,{value:{user:d,firebaseUser:r,loading:f,login:w,register:p,logout:g,sendPasswordReset:v,changePassword:y},children:t})}function d(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4257:function(e,t,r){"use strict";let n;r.d(t,{I:function(){return i},db:function(){return c}});var a=r(738),u=r(3301),s=r(5978);n=0===(0,a.C6)().length?(0,a.ZF)({apiKey:"AIzaSyCRZrcO60pVOmgG2PPE5j-OLAKnsyNQk6A",authDomain:"maan6si6uk1.firebaseapp.com",projectId:"maan6si6uk1",storageBucket:"maan6si6uk1.firebasestorage.app",messagingSenderId:"349293937280",appId:"1:349293937280:web:ca2f091d1107bae7e09c65",measurementId:"G-4LWCWNPHB2"}):(0,a.C6)()[0];let i=(0,u.v0)(n),c=(0,s.ad)(n)},287:function(e,t,r){"use strict";r.d(t,{a:function(){return n.a}});var n=r(2096)},1107:function(e,t,r){"use strict";r.d(t,{Q:function(){return s}});var n=r(2265),a=r(9376),u=r(287);function s(e){let{user:t,loading:r}=(0,u.a)(),s=(0,a.useRouter)();return(0,n.useEffect)(()=>{!r&&(t?e&&t.role!==e&&s.push("/"):s.push("/login"))},[t,r,e,s]),{user:t,loading:r}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return u}});var n=r(1994),a=r(3335);function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[358,139,137,943,971,117,744],function(){return e(e.s=446)}),_N_E=e.O()}]);