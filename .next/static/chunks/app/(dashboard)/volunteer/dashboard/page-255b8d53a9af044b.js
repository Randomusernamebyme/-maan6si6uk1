(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{1013:function(e,s,l){Promise.resolve().then(l.bind(l,9513))},9513:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return y}});var t=l(7437),r=l(287),a=l(6990),i=l(492),n=l(3146),d=l(6070),c=l(5974),o=l(8223),u=l(2265),m=l(2514),x=l(4434),f=l(3647),h=l(4004),p=l(9376),j=l(6110),g=l(2869),v=l(6815),b=l(3612);function N(e){let s,{request:l,userSkills:a,open:d,onOpenChange:f}=e,{user:N}=(0,r.a)(),y=(0,p.useRouter)(),{applications:w}=(0,b.o)(null==N?void 0:N.uid),[k,C]=(0,u.useState)(!1),[S,A]=(0,u.useState)(""),[Z,_]=(0,u.useState)(""),[q,O]=(0,u.useState)(!1),[T,R]=(0,u.useState)(""),[z,I]=(0,u.useState)(!1),Q=w.some(e=>e.requestId===l.id);l.requiredSkills&&l.requiredSkills.filter(e=>a.includes(e));let P=async()=>{if(!N){y.push("/login");return}if(!S.trim()){R("請填寫可服務時間");return}try{O(!0),R(""),I(!1);let e=await (0,h.b)();if(!e)throw Error("請先登入");let s=await fetch("/api/applications",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({requestId:l.id,volunteerId:N.uid,availableTime:S.trim(),message:Z.trim()||void 0})});if(!s.ok){let e=await s.json();throw Error(e.error||"報名失敗")}I(!0),setTimeout(()=>{f(!1),y.refresh()},2e3)}catch(e){R(e.message||"報名失敗，請稍後再試")}finally{O(!1)}};return(0,t.jsx)(j.Vq,{open:d,onOpenChange:f,children:(0,t.jsxs)(j.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(j.fK,{children:[(0,t.jsx)(j.$N,{className:"text-2xl",children:l.fields.join("、")}),(0,t.jsxs)(j.Be,{children:["發布時間：",(s=l.createdAt,(0,m.WU)(s,"yyyy年MM月dd日",{locale:x.c})),"urgent"===l.urgency&&(0,t.jsx)(c.C,{variant:"destructive",className:"ml-2",children:"緊急"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"需求描述"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:l.description})]}),l.serviceType&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"服務形式"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:l.serviceType})]}),l.estimatedDuration&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"預計時長"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:l.estimatedDuration})]}),l.requiredSkills&&l.requiredSkills.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"需要的技能"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:l.requiredSkills.map(e=>{let s=a.includes(e);return(0,t.jsxs)(c.C,{variant:s?"default":"secondary",className:s?"bg-green-600":"",children:[e,s&&" ✓"]},e)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"已報名人數"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[w.filter(e=>e.requestId===l.id).length," 人已報名"]})]}),!Q&&!z&&(0,t.jsx)(t.Fragment,{children:k?(0,t.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[T&&(0,t.jsx)(n.X,{message:T}),z&&(0,t.jsx)("div",{className:"rounded-md bg-green-50 dark:bg-green-900/20 p-4 text-sm text-green-800 dark:text-green-200",children:"報名成功！團隊會盡快聯絡你"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v._,{htmlFor:"availableTime",children:"可服務時間 *"}),(0,t.jsx)(o.I,{id:"availableTime",value:S,onChange:e=>A(e.target.value),placeholder:"例如：每週六下午2-5點",className:"bg-background",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v._,{htmlFor:"message",children:"留言（選填）"}),(0,t.jsx)("textarea",{id:"message",value:Z,onChange:e=>_(e.target.value),placeholder:"請輸入您的留言...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(g.z,{variant:"outline",onClick:()=>{C(!1),A(""),_(""),R("")},className:"flex-1",children:"取消"}),(0,t.jsx)(g.z,{onClick:P,disabled:q,className:"flex-1",children:q?(0,t.jsx)(i.g,{size:"sm"}):"提交報名"})]})]}):(0,t.jsx)(g.z,{onClick:()=>C(!0),className:"w-full",children:"報名此委托"})}),Q&&(0,t.jsx)("div",{className:"rounded-md bg-blue-50 dark:bg-blue-900/20 p-4 text-sm text-blue-800 dark:text-blue-200",children:"您已報名此委托"})]})]})})}function y(){let{user:e}=(0,r.a)(),{requests:s,loading:l,error:c}=(0,a.w)("published"),[m,x]=(0,u.useState)(""),[h,p]=(0,u.useState)("all"),[j,g]=(0,u.useState)("all"),[v,b]=(0,u.useState)("latest"),[y,k]=(0,u.useState)(null),C=(0,u.useMemo)(()=>{let l=s.filter(s=>{if((null==e?void 0:e.fields)&&e.fields.length>0&&!s.fields.some(s=>e.fields.includes(s)))return!1;if(m){let e=m.toLowerCase();if(!(s.description.toLowerCase().includes(e)||s.fields.some(s=>s.toLowerCase().includes(e))))return!1}if("all"!==h&&!s.fields.includes(h))return!1;if("all"!==j){let e="urgent"===s.urgency;if("urgent"===j&&!e||"normal"===j&&e)return!1}return!0});return l.sort((e,s)=>"latest"===v?s.createdAt.getTime()-e.createdAt.getTime():"urgent"===e.urgency&&"urgent"!==s.urgency?-1:"urgent"!==e.urgency&&"urgent"===s.urgency?1:s.createdAt.getTime()-e.createdAt.getTime()),l},[s,null==e?void 0:e.fields,m,h,j,v]),S=(0,u.useMemo)(()=>({applicationsCount:0,completedCount:0,unreadNotifications:0}),[]);return l?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(i.g,{size:"lg"})}):c?(0,t.jsx)(n.X,{message:"載入委托列表時發生錯誤"}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Hi ",(null==e?void 0:e.displayName)||"義工","！"]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 mt-4",children:[(0,t.jsx)(d.Zb,{children:(0,t.jsxs)(d.Ol,{className:"pb-2",children:[(0,t.jsx)(d.SZ,{children:"已報名委托"}),(0,t.jsx)(d.ll,{className:"text-2xl",children:S.applicationsCount})]})}),(0,t.jsx)(d.Zb,{children:(0,t.jsxs)(d.Ol,{className:"pb-2",children:[(0,t.jsx)(d.SZ,{children:"已完成委托"}),(0,t.jsx)(d.ll,{className:"text-2xl",children:S.completedCount})]})}),(0,t.jsx)(d.Zb,{children:(0,t.jsxs)(d.Ol,{className:"pb-2",children:[(0,t.jsx)(d.SZ,{children:"未讀通知"}),(0,t.jsx)(d.ll,{className:"text-2xl",children:S.unreadNotifications})]})})]})]}),(0,t.jsxs)(d.Zb,{children:[(0,t.jsxs)(d.Ol,{children:[(0,t.jsx)(d.ll,{children:"委托列表"}),(0,t.jsx)(d.SZ,{children:"選擇適合的委托進行報名"})]}),(0,t.jsx)(d.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)(o.I,{placeholder:"搜尋委托標題或描述...",value:m,onChange:e=>x(e.target.value),className:"flex-1"}),(0,t.jsxs)(f.Ph,{value:h,onValueChange:p,children:[(0,t.jsx)(f.i4,{className:"w-full md:w-[180px]",children:(0,t.jsx)(f.ki,{placeholder:"選擇領域"})}),(0,t.jsxs)(f.Bw,{children:[(0,t.jsx)(f.Ql,{value:"all",children:"所有領域"}),(0,t.jsx)(f.Ql,{value:"生活助手",children:"生活助手"}),(0,t.jsx)(f.Ql,{value:"社區拍檔",children:"社區拍檔"}),(0,t.jsx)(f.Ql,{value:"街坊樹窿",children:"街坊樹窿"})]})]}),(0,t.jsxs)(f.Ph,{value:j,onValueChange:g,children:[(0,t.jsx)(f.i4,{className:"w-full md:w-[180px]",children:(0,t.jsx)(f.ki,{placeholder:"緊急程度"})}),(0,t.jsxs)(f.Bw,{children:[(0,t.jsx)(f.Ql,{value:"all",children:"全部"}),(0,t.jsx)(f.Ql,{value:"urgent",children:"緊急"}),(0,t.jsx)(f.Ql,{value:"normal",children:"一般"})]})]}),(0,t.jsxs)(f.Ph,{value:v,onValueChange:e=>b(e),children:[(0,t.jsx)(f.i4,{className:"w-full md:w-[180px]",children:(0,t.jsx)(f.ki,{placeholder:"排序方式"})}),(0,t.jsxs)(f.Bw,{children:[(0,t.jsx)(f.Ql,{value:"latest",children:"最新"}),(0,t.jsx)(f.Ql,{value:"urgent",children:"最緊急"})]})]})]}),0===C.length?(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"目前沒有符合條件的委托"})}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:C.map(s=>(0,t.jsx)(w,{request:s,userSkills:(null==e?void 0:e.skills)||[],onClick:()=>k(s)},s.id))})]})})]}),y&&(0,t.jsx)(N,{request:y,userSkills:(null==e?void 0:e.skills)||[],open:!!y,onOpenChange:e=>!e&&k(null)})]})}function w(e){let s,{request:l,userSkills:r,onClick:a}=e,i=!!l.requiredSkills&&l.requiredSkills.some(e=>r.includes(e));return(0,t.jsxs)(d.Zb,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:a,children:[(0,t.jsxs)(d.Ol,{children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)(d.ll,{className:"text-lg line-clamp-2",children:l.fields.join("、")}),"urgent"===l.urgency&&(0,t.jsx)(c.C,{variant:"destructive",children:"緊急"})]}),(0,t.jsxs)(d.SZ,{children:["發布時間：",(s=l.createdAt,(0,m.WU)(s,"yyyy年MM月dd日",{locale:x.c}))]})]}),(0,t.jsxs)(d.aY,{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-3",children:l.description}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:l.fields.map(e=>(0,t.jsx)(c.C,{variant:"secondary",children:e},e))}),i&&(0,t.jsx)(c.C,{variant:"outline",className:"mt-2",children:"匹配您的技能"})]})]})}},8223:function(e,s,l){"use strict";l.d(s,{I:function(){return i}});var t=l(7437),r=l(2265),a=l(4508);let i=r.forwardRef((e,s)=>{let{className:l,type:r,...i}=e;return(0,t.jsx)("input",{type:r,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),ref:s,...i})});i.displayName="Input"},6815:function(e,s,l){"use strict";l.d(s,{_:function(){return c}});var t=l(7437),r=l(2265),a=l(370),i=l(535),n=l(4508);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,s)=>{let{className:l,...r}=e;return(0,t.jsx)(a.f,{ref:s,className:(0,n.cn)(d(),l),...r})});c.displayName=a.f.displayName},3647:function(e,s,l){"use strict";l.d(s,{Bw:function(){return h},Ph:function(){return o},Ql:function(){return p},i4:function(){return m},ki:function(){return u}});var t=l(7437),r=l(2265),a=l(3142),i=l(875),n=l(2135),d=l(401),c=l(4508);let o=a.fC;a.ZA;let u=a.B4,m=r.forwardRef((e,s)=>{let{className:l,children:r,...n}=e;return(0,t.jsxs)(a.xz,{ref:s,className:(0,c.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l),...n,children:[r,(0,t.jsx)(a.JO,{asChild:!0,children:(0,t.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=a.xz.displayName;let x=r.forwardRef((e,s)=>{let{className:l,...r}=e;return(0,t.jsx)(a.u_,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",l),...r,children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})});x.displayName=a.u_.displayName;let f=r.forwardRef((e,s)=>{let{className:l,...r}=e;return(0,t.jsx)(a.$G,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",l),...r,children:(0,t.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=a.$G.displayName;let h=r.forwardRef((e,s)=>{let{className:l,children:r,position:i="popper",...n}=e;return(0,t.jsx)(a.h_,{children:(0,t.jsxs)(a.VY,{ref:s,className:(0,c.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",l),position:i,...n,children:[(0,t.jsx)(x,{}),(0,t.jsx)(a.l_,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(f,{})]})})});h.displayName=a.VY.displayName,r.forwardRef((e,s)=>{let{className:l,...r}=e;return(0,t.jsx)(a.__,{ref:s,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",l),...r})}).displayName=a.__.displayName;let p=r.forwardRef((e,s)=>{let{className:l,children:r,...i}=e;return(0,t.jsxs)(a.ck,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l),...i,children:[(0,t.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(a.wU,{children:(0,t.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(a.eT,{children:r})]})});p.displayName=a.ck.displayName,r.forwardRef((e,s)=>{let{className:l,...r}=e;return(0,t.jsx)(a.Z0,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",l),...r})}).displayName=a.Z0.displayName},6990:function(e,s,l){"use strict";l.d(s,{w:function(){return n}});var t=l(2265),r=l(5978),a=l(4257),i=l(3253);function n(e){let[s,l]=(0,t.useState)([]),[n,d]=(0,t.useState)(!0),[c,o]=(0,t.useState)(null);return(0,t.useEffect)(()=>{let s=(0,r.IO)((0,r.hJ)(a.db,"requests"),(0,r.Xo)("createdAt","desc"));e&&(s=Array.isArray(e)?(0,r.IO)(s,(0,r.ar)("status","in",e)):(0,r.IO)(s,(0,r.ar)("status","==",e)));let t=(0,r.cf)(s,e=>{l(e.docs.map(e=>{let s=e.data();return{id:e.id,...s,createdAt:(0,i.C9)(s.createdAt),updatedAt:(0,i.C9)(s.updatedAt),matchedAt:s.matchedAt?(0,i.C9)(s.matchedAt):void 0,completedAt:s.completedAt?(0,i.C9)(s.completedAt):void 0}})),d(!1),o(null)},e=>{console.error("Error fetching requests:",e),o(e),d(!1)});return()=>t()},[e]),{requests:s,loading:n,error:c}}},370:function(e,s,l){"use strict";l.d(s,{f:function(){return d}});var t=l(2265);l(4887);var r=l(7053),a=l(7437),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let l=(0,r.Z8)(`Primitive.${s}`),i=t.forwardRef((e,t)=>{let{asChild:r,...i}=e,n=r?l:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(n,{...i,ref:t})});return i.displayName=`Primitive.${s}`,{...e,[s]:i}},{}),n=t.forwardRef((e,s)=>(0,a.jsx)(i.label,{...e,ref:s,onMouseDown:s=>{var l;s.target.closest("button, input, select, textarea")||(null===(l=e.onMouseDown)||void 0===l||l.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var d=n}},function(e){e.O(0,[358,139,137,943,286,142,34,600,696,222,561,489,971,117,744],function(){return e(e.s=1013)}),_N_E=e.O()}]);