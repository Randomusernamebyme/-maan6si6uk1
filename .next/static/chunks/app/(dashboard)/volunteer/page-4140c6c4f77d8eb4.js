(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{2198:function(e,t,r){Promise.resolve().then(r.bind(r,7888))},7888:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(7437),a=r(6990),s=r(6070),i=r(5974),o=r(2514),c=r(4434);function u(e){let t,{request:r,onApply:a,showRequesterInfo:u=!1}=e;return(0,n.jsxs)(s.Zb,{className:"border-2 hover:shadow-lg transition-shadow",children:[(0,n.jsx)(s.Ol,{children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(s.ll,{className:"text-xl mb-2",children:r.fields.join("、")}),(0,n.jsxs)(s.SZ,{children:["創建時間：",(t=r.createdAt,(0,o.WU)(t,"yyyy年MM月dd日",{locale:c.c}))]})]}),(0,n.jsx)(i.C,{variant:"open"===r.status?"default":"matched"===r.status?"secondary":"outline",children:"open"===r.status?"開放報名":"matched"===r.status?"已配對":"completed"===r.status?"已完成":"cancelled"===r.status?"已取消":"待審核"})]})}),(0,n.jsxs)(s.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-semibold mb-2",children:"需求描述"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:r.description})]}),u&&r.requester&&(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h4",{className:"font-semibold mb-2",children:"委托者資訊"}),(0,n.jsxs)("div",{className:"text-sm space-y-1",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"姓名："}),r.requester.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"電話："}),r.requester.phone]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"年齡："}),r.requester.age]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"地區："}),r.requester.district]})]})]}),r.appreciation&&(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h4",{className:"font-semibold mb-2",children:"回報方式"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:r.appreciation})]}),a&&"open"===r.status&&(0,n.jsx)("div",{className:"border-t pt-4",children:(0,n.jsx)("button",{onClick:()=>a(r.id),className:"w-full bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"報名此委托"})})]})]})}var l=r(492),d=r(3146),f=r(2265),m=r(287),h=r(4004),p=r(9376);function x(){let{requests:e,loading:t,error:r}=(0,a.w)("open"),{user:s}=(0,m.a)(),i=(0,p.useRouter)(),[o,c]=(0,f.useState)(null),x=async e=>{if(!s){i.push("/login");return}try{c(e);let t=await (0,h.b)();if(!t)throw Error("請先登入");let r=await fetch("/api/applications",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({requestId:e,volunteerId:s.uid})});if(!r.ok){let e=await r.json();throw Error(e.error||"報名失敗")}i.refresh(),alert("報名成功！")}catch(e){console.error("報名失敗:",e),alert("報名失敗："+(e.message||"請稍後再試"))}finally{c(null)}};return t?(0,n.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,n.jsx)(l.g,{size:"lg"})}):r?(0,n.jsx)(d.X,{message:"載入委托列表時發生錯誤"}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"可報名的委托"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"以下是目前開放報名的委托，您可以選擇適合的委托進行報名。"})]}),0===e.length?(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"目前沒有開放報名的委托"})}):(0,n.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:e.map(e=>(0,n.jsx)(u,{request:e,onApply:x,showRequesterInfo:!1},e.id))})]})}},5974:function(e,t,r){"use strict";r.d(t,{C:function(){return o}});var n=r(7437);r(2265);var a=r(535),s=r(4508);let i=(0,a.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...a}=e;return(0,n.jsx)("div",{className:(0,s.cn)(i({variant:r}),t),...a})}},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return i},aY:function(){return l},ll:function(){return c}});var n=r(7437),a=r(2265),s=r(4508);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...a})});i.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...a})});o.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("font-semibold leading-none tracking-tight",r),...a})});c.displayName="CardTitle";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...a})});u.displayName="CardDescription";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...a})});l.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},3146:function(e,t,r){"use strict";r.d(t,{X:function(){return i}});var n=r(7437),a=r(4508),s=r(9322);function i(e){let{message:t="發生錯誤，請稍後再試",className:r}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("flex items-center gap-2 rounded-md border border-destructive/50 bg-destructive/10 p-4 text-destructive",r),children:[(0,n.jsx)(s.Z,{className:"h-5 w-5"}),(0,n.jsx)("p",{className:"text-sm",children:t})]})}},492:function(e,t,r){"use strict";r.d(t,{g:function(){return s},h:function(){return i}});var n=r(7437),a=r(4508);function s(e){let{className:t,size:r="md"}=e;return(0,n.jsx)("div",{className:(0,a.cn)("flex items-center justify-center",t),children:(0,n.jsx)("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-muted border-t-foreground",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[r])})})}function i(){return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(s,{size:"lg"})})}},2096:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return l}});var n=r(7437),a=r(2265),s=r(3301),i=r(4257),o=r(5978);let c=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),[f,m]=(0,a.useState)(!0),h=async e=>{try{let t=await (0,o.QT)((0,o.JU)(i.db,"users",e));if(t.exists()){let e=t.data();return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}return null}catch(e){return console.error("Error fetching user data:",e),null}};(0,a.useEffect)(()=>{let e=(0,s.Aj)(i.I,async e=>{u(e),e?d(await h(e.uid)):d(null),m(!1)});return()=>e()},[]);let p=async(e,t)=>{try{let r=await (0,s.e5)(i.I,e,t),n=await h(r.user.uid);d(n)}catch(e){throw Error(e.message||"登入失敗")}},x=async(e,t,r)=>{try{let n=await (0,s.Xb)(i.I,e,t),a={uid:n.user.uid,email:e,role:"volunteer",displayName:r.displayName||"",phone:r.phone||"",age:r.age||"",fields:r.fields||[],skills:r.skills||[],availability:r.availability||[],targetAudience:r.targetAudience||[],goals:r.goals,status:"pending",completedTasks:0,createdAt:new Date,updatedAt:new Date};await (0,o.pl)((0,o.JU)(i.db,"users",n.user.uid),{...a,createdAt:new Date,updatedAt:new Date}),n.user&&!n.user.emailVerified&&await (0,s.w$)(n.user),d(a)}catch(e){throw Error(e.message||"註冊失敗")}},v=async()=>{try{await (0,s.w7)(i.I),d(null)}catch(e){throw Error(e.message||"登出失敗")}},g=async e=>{try{await (0,s.LS)(i.I,e)}catch(e){throw Error(e.message||"發送密碼重置郵件失敗")}},y=async(e,t)=>{try{if(!r||!r.email)throw Error("請先登入");let n=s.w9.credential(r.email,e);await (0,s.aF)(r,n),await (0,s.gQ)(r,t)}catch(e){throw Error(e.message||"修改密碼失敗")}};return(0,n.jsx)(c.Provider,{value:{user:l,firebaseUser:r,loading:f,login:p,register:x,logout:v,sendPasswordReset:g,changePassword:y},children:t})}function l(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4257:function(e,t,r){"use strict";let n;r.d(t,{I:function(){return o},db:function(){return c}});var a=r(738),s=r(3301),i=r(5978);n=0===(0,a.C6)().length?(0,a.ZF)({apiKey:"AIzaSyCRZrcO60pVOmgG2PPE5j-OLAKnsyNQk6A",authDomain:"maan6si6uk1.firebaseapp.com",projectId:"maan6si6uk1",storageBucket:"maan6si6uk1.firebasestorage.app",messagingSenderId:"349293937280",appId:"1:349293937280:web:ca2f091d1107bae7e09c65",measurementId:"G-4LWCWNPHB2"}):(0,a.C6)()[0];let o=(0,s.v0)(n),c=(0,i.ad)(n)},3253:function(e,t,r){"use strict";r.d(t,{C9:function(){return s},gU:function(){return i},iH:function(){return o}});var n=r(5978),a=r(4257);let s=e=>(null==e?void 0:e.toDate)?e.toDate():e instanceof Date?e:new Date(e);async function i(e,t,r){try{let s=(0,n.JU)(a.db,e,t),i=function(e){let t={};for(let r in e)void 0!==e[r]&&(t[r]=e[r]);return t}(r);await (0,n.r7)(s,{...i,updatedAt:n.EK.now()})}catch(t){throw console.error("Error updating document in ".concat(e,":"),t),t}}async function o(e,t){try{let r=(0,n.JU)(a.db,e,t);await (0,n.oe)(r)}catch(t){throw console.error("Error deleting document from ".concat(e,":"),t),t}}},287:function(e,t,r){"use strict";r.d(t,{a:function(){return n.a}});var n=r(2096)},6990:function(e,t,r){"use strict";r.d(t,{w:function(){return o}});var n=r(2265),a=r(5978),s=r(4257),i=r(3253);function o(e){let[t,r]=(0,n.useState)([]),[o,c]=(0,n.useState)(!0),[u,l]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let t=(0,a.IO)((0,a.hJ)(s.db,"requests"),(0,a.Xo)("createdAt","desc"));e&&(t=Array.isArray(e)?(0,a.IO)(t,(0,a.ar)("status","in",e)):(0,a.IO)(t,(0,a.ar)("status","==",e)));let n=(0,a.cf)(t,e=>{r(e.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:(0,i.C9)(t.createdAt),updatedAt:(0,i.C9)(t.updatedAt),matchedAt:t.matchedAt?(0,i.C9)(t.matchedAt):void 0,completedAt:t.completedAt?(0,i.C9)(t.completedAt):void 0}})),c(!1),l(null)},e=>{console.error("Error fetching requests:",e),l(e),c(!1)});return()=>n()},[e]),{requests:t,loading:o,error:u}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},4004:function(e,t,r){"use strict";r.d(t,{b:function(){return a}});var n=r(4257);async function a(){let e=n.I.currentUser;if(!e)return null;try{return await e.getIdToken()}catch(e){return console.error("Error getting auth token:",e),null}}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:u="",children:l,iconNode:d,...f}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:c?24*Number(o)/Number(a):o,className:s("lucide",u),...f},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),c=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:c,...u}=r;return(0,n.createElement)(o,{ref:i,iconNode:t,className:s("lucide-".concat(a(e)),c),...u})});return r.displayName="".concat(e),r}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},535:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var n=r(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=n.W,i=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:o}=t,c=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],n=null==o?void 0:o[e];if(null===t)return null;let s=a(t)||a(n);return i[e][s]}),u=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,c,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...u}[t]):({...o,...u})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[358,139,137,943,34,971,117,744],function(){return e(e.s=2198)}),_N_E=e.O()}]);