(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{6144:function(e,t,r){Promise.resolve().then(r.bind(r,1875))},1875:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(7437),a=r(3612),s=r(2265),i=r(5978),l=r(4257),o=r(3253),c=r(287),d=r(492),u=r(3146),f=r(6070),m=r(5974),p=r(2869),h=r(2514),x=r(4434),v=r(4004),j=r(9376),g=r(6110),b=r(2339);function y(){let{user:e}=(0,c.a)(),{applications:t,loading:r,error:i}=(0,a.o)(null==e?void 0:e.uid),[l,o]=(0,s.useState)("all"),f=e=>(0,h.WU)(e,"yyyy年MM月dd日 HH:mm",{locale:x.c}),m=t.filter(e=>"pending"===e.status),p=t.filter(e=>"approved"===e.status),v=t.filter(e=>"rejected"===e.status),j=t.filter(e=>"completed"===e.status),g="all"===l?t:"pending"===l?m:"approved"===l?p:"rejected"===l?v:j;return r?(0,n.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,n.jsx)(d.g,{size:"lg"})}):i?(0,n.jsx)(u.X,{message:"載入報名記錄時發生錯誤"}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"我的報名"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"以下是您已報名的委托記錄和狀態。"})]}),0===t.length?(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"您還沒有報名任何委托"})}):(0,n.jsxs)(b.mQ,{value:l,onValueChange:o,className:"w-full",children:[(0,n.jsxs)(b.dr,{className:"grid w-full grid-cols-5",children:[(0,n.jsxs)(b.SP,{value:"all",children:["全部 (",t.length,")"]}),(0,n.jsxs)(b.SP,{value:"pending",children:["待處理 (",m.length,")"]}),(0,n.jsxs)(b.SP,{value:"approved",children:["已選中 (",p.length,")"]}),(0,n.jsxs)(b.SP,{value:"rejected",children:["未選中 (",v.length,")"]}),(0,n.jsxs)(b.SP,{value:"completed",children:["已完成 (",j.length,")"]})]}),(0,n.jsx)(b.nU,{value:l,className:"mt-6",children:0===g.length?(0,n.jsx)("div",{className:"text-center py-12",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"all"===l?"您還沒有報名任何委托":"目前沒有".concat({pending:"待處理",approved:"已選中",rejected:"未選中",completed:"已完成"}[l]||l,"的報名記錄")})}):(0,n.jsx)("div",{className:"space-y-4",children:g.map(e=>(0,n.jsx)(w,{application:e,formatDate:f},e.id))})})]})]})}function w(e){let{application:t,formatDate:r}=e,{request:a,loading:c}=function(e){let[t,r]=(0,s.useState)(null),[n,a]=(0,s.useState)(!0),[c,d]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!e){a(!1);return}let t=(0,i.cf)((0,i.JU)(l.db,"requests",e),e=>{if(e.exists()){let t=e.data();r({id:e.id,...t,createdAt:(0,o.C9)(t.createdAt),updatedAt:(0,o.C9)(t.updatedAt),matchedAt:t.matchedAt?(0,o.C9)(t.matchedAt):void 0,completedAt:t.completedAt?(0,o.C9)(t.completedAt):void 0})}else r(null);a(!1),d(null)},e=>{console.error("Error fetching request:",e),d(e),a(!1)});return()=>t()},[e]),{request:t,loading:n,error:c}}(t.requestId),u=(0,j.useRouter)(),[h,x]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!1),w=async()=>{try{y(!0);let e=await (0,v.b)();if(!e)throw Error("請先登入");let r=await fetch("/api/applications/".concat(t.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}});if(!r.ok){let e=await r.json();throw Error(e.error||"撤回失敗")}x(!1),u.refresh()}catch(e){alert("撤回失敗："+(e.message||"請稍後再試"))}finally{y(!1)}};return c?(0,n.jsx)(f.Zb,{children:(0,n.jsx)(f.aY,{className:"py-6",children:(0,n.jsx)(d.g,{size:"sm"})})}):a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.Zb,{className:"border-2",children:[(0,n.jsx)(f.Ol,{children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsx)(f.ll,{className:"text-lg",children:a.fields.join("、")}),(0,n.jsx)(m.C,{variant:{pending:"outline",approved:"default",rejected:"destructive",completed:"secondary"}[t.status]||"outline",children:{pending:"待處理",approved:"已選中",rejected:"未選中",completed:"已完成"}[t.status]||t.status})]})}),(0,n.jsxs)(f.aY,{className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:a.description})}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"報名時間："}),(0,n.jsx)("span",{children:r(t.createdAt)})]}),t.availableTime&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"可服務時間："}),(0,n.jsx)("span",{children:t.availableTime})]}),t.matchedAt&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"配對時間："}),(0,n.jsx)("span",{children:r(t.matchedAt)})]}),t.completedAt&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"完成時間："}),(0,n.jsx)("span",{children:r(t.completedAt)})]})]}),t.message&&(0,n.jsx)("div",{className:"border-t pt-4",children:(0,n.jsxs)("p",{className:"text-sm",children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"您的留言："}),t.message]})}),"approved"===t.status&&(0,n.jsx)("div",{className:"border-t pt-4",children:(0,n.jsx)("div",{className:"rounded-md bg-blue-50 dark:bg-blue-900/20 p-4 text-sm text-blue-800 dark:text-blue-200",children:"請留意 WhatsApp，團隊會聯絡你"})}),"pending"===t.status&&(0,n.jsx)("div",{className:"border-t pt-4",children:(0,n.jsx)(p.z,{variant:"outline",onClick:()=>x(!0),className:"w-full",children:"撤回報名"})})]})]}),(0,n.jsx)(g.Vq,{open:h,onOpenChange:x,children:(0,n.jsxs)(g.cZ,{children:[(0,n.jsxs)(g.fK,{children:[(0,n.jsx)(g.$N,{children:"確認撤回報名"}),(0,n.jsx)(g.Be,{children:"您確定要撤回此報名嗎？此操作無法復原。"})]}),(0,n.jsxs)(g.cN,{children:[(0,n.jsx)(p.z,{variant:"outline",onClick:()=>x(!1),disabled:b,children:"取消"}),(0,n.jsx)(p.z,{variant:"destructive",onClick:w,disabled:b,children:b?(0,n.jsx)(d.g,{size:"sm"}):"確認撤回"})]})]})})]}):null}},2339:function(e,t,r){"use strict";r.d(t,{SP:function(){return c},dr:function(){return o},mQ:function(){return l},nU:function(){return d}});var n=r(7437),a=r(2265),s=r(271),i=r(4508);let l=s.fC,o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.aV,{ref:t,className:(0,i.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...a})});o.displayName=s.aV.displayName;let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.xz,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...a})});c.displayName=s.xz.displayName;let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.VY,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});d.displayName=s.VY.displayName},1353:function(e,t,r){"use strict";r.d(t,{Pc:function(){return y},ck:function(){return F},fC:function(){return T}});var n=r(2265),a=r(6741),s=r(9923),i=r(8575),l=r(3966),o=r(9255),c=r(2912),d=r(6606),u=r(886),f=r(9114),m=r(7437),p="rovingFocusGroup.onEntryFocus",h={bubbles:!1,cancelable:!0},x="RovingFocusGroup",[v,j,g]=(0,s.B)(x),[b,y]=(0,l.b)(x,[g]),[w,N]=b(x),A=n.forwardRef((e,t)=>(0,m.jsx)(v.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,m.jsx)(v.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,m.jsx)(C,{...e,ref:t})})}));A.displayName=x;var C=n.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,orientation:s,loop:l=!1,dir:o,currentTabStopId:v,defaultCurrentTabStopId:g,onCurrentTabStopIdChange:b,onEntryFocus:y,preventScrollOnEntryFocus:N=!1,...A}=e,C=n.useRef(null),R=(0,i.e)(t,C),k=(0,f.gm)(o),[E,T]=(0,u.T)({prop:v,defaultProp:null!=g?g:null,onChange:b,caller:x}),[F,I]=n.useState(!1),M=(0,d.W)(y),D=j(r),V=n.useRef(!1),[P,z]=n.useState(0);return n.useEffect(()=>{let e=C.current;if(e)return e.addEventListener(p,M),()=>e.removeEventListener(p,M)},[M]),(0,m.jsx)(w,{scope:r,orientation:s,dir:k,loop:l,currentTabStopId:E,onItemFocus:n.useCallback(e=>T(e),[T]),onItemShiftTab:n.useCallback(()=>I(!0),[]),onFocusableItemAdd:n.useCallback(()=>z(e=>e+1),[]),onFocusableItemRemove:n.useCallback(()=>z(e=>e-1),[]),children:(0,m.jsx)(c.WV.div,{tabIndex:F||0===P?-1:0,"data-orientation":s,...A,ref:R,style:{outline:"none",...e.style},onMouseDown:(0,a.Mj)(e.onMouseDown,()=>{V.current=!0}),onFocus:(0,a.Mj)(e.onFocus,e=>{let t=!V.current;if(e.target===e.currentTarget&&t&&!F){let t=new CustomEvent(p,h);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=D().filter(e=>e.focusable);S([e.find(e=>e.active),e.find(e=>e.id===E),...e].filter(Boolean).map(e=>e.ref.current),N)}}V.current=!1}),onBlur:(0,a.Mj)(e.onBlur,()=>I(!1))})})}),R="RovingFocusGroupItem",k=n.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:r,focusable:s=!0,active:i=!1,tabStopId:l,children:d,...u}=e,f=(0,o.M)(),p=l||f,h=N(R,r),x=h.currentTabStopId===p,g=j(r),{onFocusableItemAdd:b,onFocusableItemRemove:y,currentTabStopId:w}=h;return n.useEffect(()=>{if(s)return b(),()=>y()},[s,b,y]),(0,m.jsx)(v.ItemSlot,{scope:r,id:p,focusable:s,active:i,children:(0,m.jsx)(c.WV.span,{tabIndex:x?0:-1,"data-orientation":h.orientation,...u,ref:t,onMouseDown:(0,a.Mj)(e.onMouseDown,e=>{s?h.onItemFocus(p):e.preventDefault()}),onFocus:(0,a.Mj)(e.onFocus,()=>h.onItemFocus(p)),onKeyDown:(0,a.Mj)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){h.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,r){var n;let a=(n=e.key,"rtl"!==r?n:"ArrowLeft"===n?"ArrowRight":"ArrowRight"===n?"ArrowLeft":n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return E[a]}(e,h.orientation,h.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let a=g().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)a.reverse();else if("prev"===t||"next"===t){var r,n;"prev"===t&&a.reverse();let s=a.indexOf(e.currentTarget);a=h.loop?(r=a,n=s+1,r.map((e,t)=>r[(n+t)%r.length])):a.slice(s+1)}setTimeout(()=>S(a))}}),children:"function"==typeof d?d({isCurrentTabStop:x,hasTabStop:null!=w}):d})})});k.displayName=R;var E={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.activeElement;for(let n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}var T=A,F=k},271:function(e,t,r){"use strict";r.d(t,{VY:function(){return F},aV:function(){return S},fC:function(){return E},xz:function(){return T}});var n=r(2265),a=r(6741),s=r(3966),i=r(1353),l=r(1599),o=r(2912),c=r(9114),d=r(886),u=r(9255),f=r(7437),m="Tabs",[p,h]=(0,s.b)(m,[i.Pc]),x=(0,i.Pc)(),[v,j]=p(m),g=n.forwardRef((e,t)=>{let{__scopeTabs:r,value:n,onValueChange:a,defaultValue:s,orientation:i="horizontal",dir:l,activationMode:p="automatic",...h}=e,x=(0,c.gm)(l),[j,g]=(0,d.T)({prop:n,onChange:a,defaultProp:null!=s?s:"",caller:m});return(0,f.jsx)(v,{scope:r,baseId:(0,u.M)(),value:j,onValueChange:g,orientation:i,dir:x,activationMode:p,children:(0,f.jsx)(o.WV.div,{dir:x,"data-orientation":i,...h,ref:t})})});g.displayName=m;var b="TabsList",y=n.forwardRef((e,t)=>{let{__scopeTabs:r,loop:n=!0,...a}=e,s=j(b,r),l=x(r);return(0,f.jsx)(i.fC,{asChild:!0,...l,orientation:s.orientation,dir:s.dir,loop:n,children:(0,f.jsx)(o.WV.div,{role:"tablist","aria-orientation":s.orientation,...a,ref:t})})});y.displayName=b;var w="TabsTrigger",N=n.forwardRef((e,t)=>{let{__scopeTabs:r,value:n,disabled:s=!1,...l}=e,c=j(w,r),d=x(r),u=R(c.baseId,n),m=k(c.baseId,n),p=n===c.value;return(0,f.jsx)(i.ck,{asChild:!0,...d,focusable:!s,active:p,children:(0,f.jsx)(o.WV.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":m,"data-state":p?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:u,...l,ref:t,onMouseDown:(0,a.Mj)(e.onMouseDown,e=>{s||0!==e.button||!1!==e.ctrlKey?e.preventDefault():c.onValueChange(n)}),onKeyDown:(0,a.Mj)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&c.onValueChange(n)}),onFocus:(0,a.Mj)(e.onFocus,()=>{let e="manual"!==c.activationMode;p||s||!e||c.onValueChange(n)})})})});N.displayName=w;var A="TabsContent",C=n.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,forceMount:s,children:i,...c}=e,d=j(A,r),u=R(d.baseId,a),m=k(d.baseId,a),p=a===d.value,h=n.useRef(p);return n.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,f.jsx)(l.z,{present:s||p,children:r=>{let{present:n}=r;return(0,f.jsx)(o.WV.div,{"data-state":p?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":u,hidden:!n,id:m,tabIndex:0,...c,ref:t,style:{...e.style,animationDuration:h.current?"0s":void 0},children:n&&i})}})});function R(e,t){return"".concat(e,"-trigger-").concat(t)}function k(e,t){return"".concat(e,"-content-").concat(t)}C.displayName=A;var E=g,S=y,T=N,F=C}},function(e){e.O(0,[358,139,137,943,286,142,34,600,561,489,971,117,744],function(){return e(e.s=6144)}),_N_E=e.O()}]);