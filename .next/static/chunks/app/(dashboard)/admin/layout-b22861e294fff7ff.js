(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[940],{330:function(e,t,r){Promise.resolve().then(r.bind(r,8253))},8253:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(7437),n=r(1107),s=r(492),u=r(7648),i=r(9376),c=r(4508);function l(e){let{children:t}=e,{user:r,loading:l}=(0,n.Q)("admin"),d=(0,i.usePathname)();return l?(0,a.jsx)(s.h,{}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"管理後台"}),r&&(0,a.jsxs)("p",{className:"text-muted-foreground mt-2",children:["歡迎，",r.displayName,"！"]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,a.jsx)("aside",{className:"w-full md:w-64 flex-shrink-0",children:(0,a.jsx)("nav",{className:"space-y-1",children:[{href:"/admin",label:"儀表板"},{href:"/admin/requests",label:"委托管理"},{href:"/admin/volunteers",label:"義工管理"},{href:"/admin/applications",label:"報名管理"},{href:"/admin/logs",label:"操作日誌"},{href:"/admin/export",label:"數據匯出"}].map(e=>{let t=d===e.href||"/admin"!==e.href&&d.startsWith(e.href);return(0,a.jsx)(u.default,{href:e.href,className:(0,c.cn)("flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors",t?"bg-foreground text-background":"text-foreground/60 hover:bg-muted hover:text-foreground"),children:e.label},e.href)})})}),(0,a.jsx)("main",{className:"flex-1 min-w-0",children:t})]})]})}},492:function(e,t,r){"use strict";r.d(t,{g:function(){return s},h:function(){return u}});var a=r(7437),n=r(4508);function s(e){let{className:t,size:r="md"}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex items-center justify-center",t),children:(0,a.jsx)("div",{className:(0,n.cn)("animate-spin rounded-full border-2 border-muted border-t-foreground",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[r])})})}function u(){return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)(s,{size:"lg"})})}},2096:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return d}});var a=r(7437),n=r(2265),s=r(3301),u=r(4257),i=r(5978);let c=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[d,o]=(0,n.useState)(null),[f,m]=(0,n.useState)(!0),h=async e=>{try{let t=await (0,i.QT)((0,i.JU)(u.db,"users",e));if(t.exists()){let e=t.data();return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}return null}catch(e){return console.error("Error fetching user data:",e),null}};(0,n.useEffect)(()=>{let e=(0,s.Aj)(u.I,async e=>{l(e),e?o(await h(e.uid)):o(null),m(!1)});return()=>e()},[]);let p=async(e,t)=>{try{let r=await (0,s.e5)(u.I,e,t),a=await h(r.user.uid);o(a)}catch(e){throw Error(e.message||"登入失敗")}},w=async(e,t,r)=>{try{let a=await (0,s.Xb)(u.I,e,t),n={uid:a.user.uid,email:e,role:"volunteer",displayName:r.displayName||"",phone:r.phone||"",age:r.age||"",fields:r.fields||[],skills:r.skills||[],availability:r.availability||[],targetAudience:r.targetAudience||[],goals:r.goals,status:"pending",completedTasks:0,createdAt:new Date,updatedAt:new Date};await (0,i.pl)((0,i.JU)(u.db,"users",a.user.uid),{...n,createdAt:new Date,updatedAt:new Date}),a.user&&!a.user.emailVerified&&await (0,s.w$)(a.user),o(n)}catch(e){throw Error(e.message||"註冊失敗")}},x=async()=>{try{await (0,s.w7)(u.I),o(null)}catch(e){throw Error(e.message||"登出失敗")}},g=async e=>{try{await (0,s.LS)(u.I,e)}catch(e){throw Error(e.message||"發送密碼重置郵件失敗")}},v=async(e,t)=>{try{if(!r||!r.email)throw Error("請先登入");let a=s.w9.credential(r.email,e);await (0,s.aF)(r,a),await (0,s.gQ)(r,t)}catch(e){throw Error(e.message||"修改密碼失敗")}};return(0,a.jsx)(c.Provider,{value:{user:d,firebaseUser:r,loading:f,login:p,register:w,logout:x,sendPasswordReset:g,changePassword:v},children:t})}function d(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4257:function(e,t,r){"use strict";let a;r.d(t,{I:function(){return i},db:function(){return c}});var n=r(738),s=r(3301),u=r(5978);a=0===(0,n.C6)().length?(0,n.ZF)({apiKey:"AIzaSyCRZrcO60pVOmgG2PPE5j-OLAKnsyNQk6A",authDomain:"maan6si6uk1.firebaseapp.com",projectId:"maan6si6uk1",storageBucket:"maan6si6uk1.firebasestorage.app",messagingSenderId:"349293937280",appId:"1:349293937280:web:ca2f091d1107bae7e09c65",measurementId:"G-4LWCWNPHB2"}):(0,n.C6)()[0];let i=(0,s.v0)(a),c=(0,u.ad)(a)},287:function(e,t,r){"use strict";r.d(t,{a:function(){return a.a}});var a=r(2096)},1107:function(e,t,r){"use strict";r.d(t,{Q:function(){return u}});var a=r(2265),n=r(9376),s=r(287);function u(e){let{user:t,loading:r}=(0,s.a)(),u=(0,n.useRouter)();return(0,a.useEffect)(()=>{!r&&(t?e&&t.role!==e&&u.push("/"):u.push("/login"))},[t,r,e,u]),{user:t,loading:r}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var a=r(1994),n=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(2972),n=r.n(a)},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[358,139,137,943,972,971,117,744],function(){return e(e.s=330)}),_N_E=e.O()}]);