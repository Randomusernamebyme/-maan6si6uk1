(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{5681:function(e,s,a){Promise.resolve().then(a.bind(a,1899)),Promise.resolve().then(a.t.bind(a,2972,23))},1899:function(e,s,a){"use strict";a.d(s,{RegisterForm:function(){return k}});var t=a(7437),l=a(2265),i=a(9376),r=a(9501),c=a(3590),n=a(7119),d=a(287),o=a(2869),u=a(8223),m=a(6815),h=a(2204),p=a(3146),x=a(492),f=a(2934);function g(e){let{onComplete:s}=e,[a,i]=(0,l.useState)(!0),[r,c]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{setTimeout(()=>c(!0),100);let e=setTimeout(()=>{i(!1),null==s||s()},3e3);return()=>clearTimeout(e)},[s]),a)?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"text-center space-y-4 transition-all duration-500 ".concat(r?"opacity-100 scale-100":"opacity-0 scale-95"),children:[(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"rounded-full bg-primary p-6 transition-all duration-500 ".concat(r?"scale-100 rotate-0":"scale-0 rotate-180"),children:(0,t.jsx)(f.Z,{className:"h-16 w-16 text-primary-foreground"})})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold",children:"感謝報名！"}),(0,t.jsx)("p",{className:"text-lg text-muted-foreground",children:"我們會在一週內 WhatsApp 聯絡你安排面試"})]})]})}):null}let j=n.Ry({email:n.Z_().email("請輸入有效的電子郵件"),password:n.Z_().min(8,"密碼至少需要 8 個字元").regex(/[a-zA-Z]/,"密碼必須包含至少一個字母").regex(/[0-9]/,"密碼必須包含至少一個數字"),confirmPassword:n.Z_().min(8,"請確認密碼"),displayName:n.Z_().min(1,"請輸入您的稱呼"),phone:n.Z_().min(1,"請輸入電話號碼").regex(/^[0-9+\-\s()]+$/,"請輸入有效的電話號碼格式"),age:n.Km(["12-17","18-24"],{required_error:"請選擇年齡範圍"}),fields:n.IX(n.Km(["生活助手","社區拍檔","街坊樹窿"])).min(1,"請至少選擇一個服務範疇"),skills:n.IX(n.Z_()).optional(),availability:n.IX(n.Z_()).min(1,"請至少選擇一個空閒日子"),targetAudience:n.IX(n.Z_()).optional(),goals:n.Z_().optional()}).refine(e=>e.password===e.confirmPassword,{message:"密碼不一致",path:["confirmPassword"]}),y=["生活助手","社區拍檔","街坊樹窿"],N=["12-17","18-24"],v=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],b=["唱歌","跳舞","煮嘢食","玩音樂","清潔","傾偈","情緒支援","維修物件"],w=["兒童","年輕人","成年人","長者","少數族裔"];function k(){let e=(0,i.useRouter)(),{register:s}=(0,d.a)(),[a,n]=(0,l.useState)(""),[f,k]=(0,l.useState)(!1),[_,A]=(0,l.useState)(""),[C,I]=(0,l.useState)(""),[F,O]=(0,l.useState)(!1),{register:P,handleSubmit:S,watch:E,setValue:Z,formState:{errors:X}}=(0,r.cI)({resolver:(0,c.F)(j),defaultValues:{fields:[],skills:[],availability:[],targetAudience:[]}}),D=E("fields")||[],V=E("skills")||[],z=E("availability")||[],T=E("targetAudience")||[],K=e=>{let s=E("fields")||[];Z("fields",s.includes(e)?s.filter(s=>s!==e):[...s,e],{shouldValidate:!0})},R=e=>{let s=E("skills")||[];Z("skills",s.includes(e)?s.filter(s=>s!==e):[...s,e],{shouldValidate:!0})},W=e=>{let s=E("availability")||[];Z("availability",s.includes(e)?s.filter(s=>s!==e):[...s,e],{shouldValidate:!0})},L=e=>{let s=E("targetAudience")||[];Z("targetAudience",s.includes(e)?s.filter(s=>s!==e):[...s,e],{shouldValidate:!0})},Q=async e=>{try{n(""),k(!0);let a=(e.skills||[]).filter(e=>"Other"!==e);if(_.trim()){let e=_.split(",").map(e=>e.trim()).filter(e=>e.length>0);a.push(...e)}let t=(e.targetAudience||[]).filter(e=>"Other"!==e);if(C.trim()){let e=C.split(",").map(e=>e.trim()).filter(e=>e.length>0);t.push(...e)}await s(e.email,e.password,{displayName:e.displayName,phone:e.phone,age:e.age,fields:e.fields,skills:a,availability:e.availability,targetAudience:t,goals:e.goals}),O(!0)}catch(e){n(e.message||"註冊失敗，請稍後再試")}finally{k(!1)}};return(0,t.jsxs)("form",{onSubmit:S(Q),className:"space-y-6",children:[a&&(0,t.jsx)(p.X,{message:a}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"email",children:"電子郵件 *"}),(0,t.jsx)(u.I,{id:"email",type:"email",...P("email"),placeholder:"your@email.com",className:"bg-background"}),X.email&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.email.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"password",children:"密碼 *"}),(0,t.jsx)(u.I,{id:"password",type:"password",...P("password"),placeholder:"至少 6 個字元",className:"bg-background"}),X.password&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.password.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"confirmPassword",children:"確認密碼 *"}),(0,t.jsx)(u.I,{id:"confirmPassword",type:"password",...P("confirmPassword"),placeholder:"再次輸入密碼",className:"bg-background"}),X.confirmPassword&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.confirmPassword.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"displayName",children:"點樣稱呼你？ *"}),(0,t.jsx)(u.I,{id:"displayName",...P("displayName"),placeholder:"您的稱呼",className:"bg-background"}),X.displayName&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.displayName.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"phone",children:"電話號碼 (WhatsApp) *"}),(0,t.jsx)(u.I,{id:"phone",...P("phone"),placeholder:"您的電話號碼",className:"bg-background"}),X.phone&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.phone.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{children:"年齡 *"}),(0,t.jsx)("div",{className:"space-y-2",children:N.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"radio",id:"age-".concat(e),value:e,...P("age"),className:"h-4 w-4"}),(0,t.jsx)(m._,{htmlFor:"age-".concat(e),className:"font-normal cursor-pointer",children:e})]},e))}),X.age&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.age.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{children:"幫助範疇 *"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"我哋有社區拍檔、街坊樹窿、同埋生活助手，你認為自己適合加入邊一/幾個範疇？"}),(0,t.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"field-".concat(e),checked:D.includes(e),onCheckedChange:()=>K(e)}),(0,t.jsx)(m._,{htmlFor:"field-".concat(e),className:"font-normal cursor-pointer",children:e})]},e))}),X.fields&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.fields.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{children:"你想提供的技能？ *"}),(0,t.jsxs)("div",{className:"space-y-2",children:[b.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"skill-".concat(e),checked:V.includes(e),onCheckedChange:()=>R(e)}),(0,t.jsx)(m._,{htmlFor:"skill-".concat(e),className:"font-normal cursor-pointer",children:e})]},e)),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"skill-other",checked:V.includes("Other"),onCheckedChange:e=>{e?R("Other"):(Z("skills",V.filter(e=>"Other"!==e),{shouldValidate:!0}),A(""))}}),(0,t.jsx)(m._,{htmlFor:"skill-other",className:"font-normal cursor-pointer",children:"Other:"}),V.includes("Other")&&(0,t.jsx)(u.I,{value:_,onChange:e=>A(e.target.value),placeholder:"請輸入其他技能（多個技能請用逗號分隔）",className:"bg-background flex-1"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{children:"一星期內你比較空閒的日子 *"}),(0,t.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"availability-".concat(e),checked:z.includes(e),onCheckedChange:()=>W(e)}),(0,t.jsx)(m._,{htmlFor:"availability-".concat(e),className:"font-normal cursor-pointer",children:e})]},e))}),X.availability&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:X.availability.message})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{children:"你想服務的對象？ *"}),(0,t.jsxs)("div",{className:"space-y-2",children:[w.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"audience-".concat(e),checked:T.includes(e),onCheckedChange:()=>L(e)}),(0,t.jsx)(m._,{htmlFor:"audience-".concat(e),className:"font-normal cursor-pointer",children:e})]},e)),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.X,{id:"audience-other",checked:T.includes("Other"),onCheckedChange:e=>{e?L("Other"):(Z("targetAudience",T.filter(e=>"Other"!==e),{shouldValidate:!0}),I(""))}}),(0,t.jsx)(m._,{htmlFor:"audience-other",className:"font-normal cursor-pointer",children:"Other:"}),T.includes("Other")&&(0,t.jsx)(u.I,{value:C,onChange:e=>I(e.target.value),placeholder:"請輸入其他對象（多個對象請用逗號分隔）",className:"bg-background flex-1"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m._,{htmlFor:"goals",children:"(如有) 你想喺「堅城萬事屋」完成的目標？"}),(0,t.jsx)("textarea",{id:"goals",...P("goals"),placeholder:"請輸入您的目標",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"})]}),(0,t.jsx)(o.z,{type:"submit",className:"w-full",disabled:f,children:f?(0,t.jsx)(x.g,{size:"sm"}):"註冊"}),F&&(0,t.jsx)(g,{onComplete:()=>{e.push("/"),e.refresh()}})]})}},2096:function(e,s,a){"use strict";a.d(s,{AuthProvider:function(){return d},a:function(){return o}});var t=a(7437),l=a(2265),i=a(3301),r=a(4257),c=a(5978);let n=(0,l.createContext)(void 0);function d(e){let{children:s}=e,[a,d]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(!0),p=async e=>{try{let s=await (0,c.QT)((0,c.JU)(r.db,"users",e));if(s.exists()){let e=s.data();return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}return null}catch(e){return console.error("Error fetching user data:",e),null}};(0,l.useEffect)(()=>{let e=(0,i.Aj)(r.I,async e=>{d(e),e?u(await p(e.uid)):u(null),h(!1)});return()=>e()},[]);let x=async(e,s)=>{try{let a=await (0,i.e5)(r.I,e,s),t=await p(a.user.uid);u(t)}catch(e){throw Error(e.message||"登入失敗")}},f=async(e,s,a)=>{try{let t=await (0,i.Xb)(r.I,e,s),l={uid:t.user.uid,email:e,role:"volunteer",displayName:a.displayName||"",phone:a.phone||"",age:a.age||"",fields:a.fields||[],skills:a.skills||[],availability:a.availability||[],targetAudience:a.targetAudience||[],goals:a.goals,status:"pending",completedTasks:0,createdAt:new Date,updatedAt:new Date};await (0,c.pl)((0,c.JU)(r.db,"users",t.user.uid),{...l,createdAt:new Date,updatedAt:new Date}),t.user&&!t.user.emailVerified&&await (0,i.w$)(t.user),u(l)}catch(e){throw Error(e.message||"註冊失敗")}},g=async()=>{try{await (0,i.w7)(r.I),u(null)}catch(e){throw Error(e.message||"登出失敗")}},j=async e=>{try{await (0,i.LS)(r.I,e)}catch(e){throw Error(e.message||"發送密碼重置郵件失敗")}},y=async(e,s)=>{try{if(!a||!a.email)throw Error("請先登入");let t=i.w9.credential(a.email,e);await (0,i.aF)(a,t),await (0,i.gQ)(a,s)}catch(e){throw Error(e.message||"修改密碼失敗")}};return(0,t.jsx)(n.Provider,{value:{user:o,firebaseUser:a,loading:m,login:x,register:f,logout:g,sendPasswordReset:j,changePassword:y},children:s})}function o(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4257:function(e,s,a){"use strict";let t;a.d(s,{I:function(){return c},db:function(){return n}});var l=a(738),i=a(3301),r=a(5978);t=0===(0,l.C6)().length?(0,l.ZF)({apiKey:"AIzaSyCRZrcO60pVOmgG2PPE5j-OLAKnsyNQk6A",authDomain:"maan6si6uk1.firebaseapp.com",projectId:"maan6si6uk1",storageBucket:"maan6si6uk1.firebasestorage.app",messagingSenderId:"349293937280",appId:"1:349293937280:web:ca2f091d1107bae7e09c65",measurementId:"G-4LWCWNPHB2"}):(0,l.C6)()[0];let c=(0,i.v0)(t),n=(0,r.ad)(t)},287:function(e,s,a){"use strict";a.d(s,{a:function(){return t.a}});var t=a(2096)}},function(e){e.O(0,[358,139,137,943,972,286,287,854,971,117,744],function(){return e(e.s=5681)}),_N_E=e.O()}]);