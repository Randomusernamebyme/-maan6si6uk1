(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{800:function(e,t,r){Promise.resolve().then(r.bind(r,5317)),Promise.resolve().then(r.t.bind(r,2972,23))},5317:function(e,t,r){"use strict";r.d(t,{LoginForm:function(){return y}});var n=r(7437),a=r(2265),s=r(9376),i=r(9501),l=r(3590),o=r(7119),u=r(287),c=r(2869),d=r(8223),f=r(6815),m=r(3146),p=r(492);let h=o.Ry({email:o.Z_().email("請輸入有效的電子郵件"),password:o.Z_().min(6,"密碼至少需要 6 個字元")});function y(){let e=(0,s.useRouter)(),{login:t,sendPasswordReset:r}=(0,u.a)(),[o,y]=(0,a.useState)(""),[g,v]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1),[w,j]=(0,a.useState)(""),[N,k]=(0,a.useState)(!1),[A,E]=(0,a.useState)(!1),{register:_,handleSubmit:C,formState:{errors:S}}=(0,i.cI)({resolver:(0,l.F)(h)}),I=async r=>{try{y(""),v(!0),await t(r.email,r.password),e.push("/volunteer/dashboard"),e.refresh()}catch(e){y(e.message||"登入失敗，請檢查您的帳號密碼")}finally{v(!1)}};return(0,n.jsxs)("form",{onSubmit:C(I),className:"space-y-4",children:[o&&(0,n.jsx)(m.X,{message:o}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(f._,{htmlFor:"email",children:"電子郵件"}),(0,n.jsx)(d.I,{id:"email",type:"email",..._("email"),placeholder:"your@email.com",className:"bg-background"}),S.email&&(0,n.jsx)("p",{className:"text-sm text-destructive",children:S.email.message})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(f._,{htmlFor:"password",children:"密碼"}),(0,n.jsx)("button",{type:"button",onClick:()=>b(!0),className:"text-sm text-muted-foreground hover:text-foreground underline",children:"忘記密碼？"})]}),(0,n.jsx)(d.I,{id:"password",type:"password",..._("password"),placeholder:"••••••••",className:"bg-background"}),S.password&&(0,n.jsx)("p",{className:"text-sm text-destructive",children:S.password.message})]}),(0,n.jsx)(c.z,{type:"submit",className:"w-full",disabled:g,children:g?(0,n.jsx)(p.g,{size:"sm"}):"登入"}),x&&(0,n.jsxs)("div",{className:"mt-4 p-4 border rounded-md space-y-3",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"忘記密碼"}),A?(0,n.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:"密碼重置郵件已發送到您的郵箱，請檢查您的收件箱。"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(f._,{htmlFor:"resetEmail",children:"電子郵件"}),(0,n.jsx)(d.I,{id:"resetEmail",type:"email",value:w,onChange:e=>j(e.target.value),placeholder:"your@email.com",className:"bg-background"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(c.z,{type:"button",variant:"outline",onClick:()=>{b(!1),j(""),E(!1)},className:"flex-1",children:"取消"}),(0,n.jsx)(c.z,{type:"button",onClick:async()=>{try{k(!0),y(""),await r(w),E(!0)}catch(e){y(e.message||"發送失敗，請稍後再試")}finally{k(!1)}},disabled:N||!w,className:"flex-1",children:N?(0,n.jsx)(p.g,{size:"sm"}):"發送重置郵件"})]})]})]})]})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return u}});var n=r(7437),a=r(2265),s=r(7053),i=r(535),l=r(4508);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90 hover:text-primary-foreground",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,asChild:u=!1,...c}=e,d=u?s.g7:"button";return(0,n.jsx)(d,{className:(0,l.cn)(o({variant:a,size:i,className:r})),ref:t,...c})});u.displayName="Button"},3146:function(e,t,r){"use strict";r.d(t,{X:function(){return i}});var n=r(7437),a=r(4508),s=r(9322);function i(e){let{message:t="發生錯誤，請稍後再試",className:r}=e;return(0,n.jsxs)("div",{className:(0,a.cn)("flex items-center gap-2 rounded-md border border-destructive/50 bg-destructive/10 p-4 text-destructive",r),children:[(0,n.jsx)(s.Z,{className:"h-5 w-5"}),(0,n.jsx)("p",{className:"text-sm",children:t})]})}},8223:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var n=r(7437),a=r(2265),s=r(4508);let i=a.forwardRef((e,t)=>{let{className:r,type:a,...i}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...i})});i.displayName="Input"},6815:function(e,t,r){"use strict";r.d(t,{_:function(){return u}});var n=r(7437),a=r(2265),s=r(370),i=r(535),l=r(4508);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.f,{ref:t,className:(0,l.cn)(o(),r),...a})});u.displayName=s.f.displayName},492:function(e,t,r){"use strict";r.d(t,{g:function(){return s},h:function(){return i}});var n=r(7437),a=r(4508);function s(e){let{className:t,size:r="md"}=e;return(0,n.jsx)("div",{className:(0,a.cn)("flex items-center justify-center",t),children:(0,n.jsx)("div",{className:(0,a.cn)("animate-spin rounded-full border-2 border-muted border-t-foreground",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[r])})})}function i(){return(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(s,{size:"lg"})})}},2096:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return c}});var n=r(7437),a=r(2265),s=r(3301),i=r(4257),l=r(5978);let o=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[f,m]=(0,a.useState)(!0),p=async e=>{try{let t=await (0,l.QT)((0,l.JU)(i.db,"users",e));if(t.exists()){let e=t.data();return{...e,createdAt:e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),updatedAt:e.updatedAt instanceof Date?e.updatedAt:new Date(e.updatedAt)}}return null}catch(e){return console.error("Error fetching user data:",e),null}};(0,a.useEffect)(()=>{let e=(0,s.Aj)(i.I,async e=>{u(e),e?d(await p(e.uid)):d(null),m(!1)});return()=>e()},[]);let h=async(e,t)=>{try{let r=await (0,s.e5)(i.I,e,t),n=await p(r.user.uid);d(n)}catch(e){throw Error(e.message||"登入失敗")}},y=async(e,t,r)=>{try{let n=await (0,s.Xb)(i.I,e,t),a={uid:n.user.uid,email:e,role:"volunteer",displayName:r.displayName||"",phone:r.phone||"",age:r.age||"",fields:r.fields||[],skills:r.skills||[],availability:r.availability||[],targetAudience:r.targetAudience||[],goals:r.goals,status:"pending",completedTasks:0,createdAt:new Date,updatedAt:new Date};await (0,l.pl)((0,l.JU)(i.db,"users",n.user.uid),{...a,createdAt:new Date,updatedAt:new Date}),n.user&&!n.user.emailVerified&&await (0,s.w$)(n.user),d(a)}catch(e){throw Error(e.message||"註冊失敗")}},g=async()=>{try{await (0,s.w7)(i.I),d(null)}catch(e){throw Error(e.message||"登出失敗")}},v=async e=>{try{await (0,s.LS)(i.I,e)}catch(e){throw Error(e.message||"發送密碼重置郵件失敗")}},x=async(e,t)=>{try{if(!r||!r.email)throw Error("請先登入");let n=s.w9.credential(r.email,e);await (0,s.aF)(r,n),await (0,s.gQ)(r,t)}catch(e){throw Error(e.message||"修改密碼失敗")}};return(0,n.jsx)(o.Provider,{value:{user:c,firebaseUser:r,loading:f,login:h,register:y,logout:g,sendPasswordReset:v,changePassword:x},children:t})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4257:function(e,t,r){"use strict";let n;r.d(t,{I:function(){return l},db:function(){return o}});var a=r(738),s=r(3301),i=r(5978);n=0===(0,a.C6)().length?(0,a.ZF)({apiKey:"AIzaSyCRZrcO60pVOmgG2PPE5j-OLAKnsyNQk6A",authDomain:"maan6si6uk1.firebaseapp.com",projectId:"maan6si6uk1",storageBucket:"maan6si6uk1.firebasestorage.app",messagingSenderId:"349293937280",appId:"1:349293937280:web:ca2f091d1107bae7e09c65",measurementId:"G-4LWCWNPHB2"}):(0,a.C6)()[0];let l=(0,s.v0)(n),o=(0,i.ad)(n)},287:function(e,t,r){"use strict";r.d(t,{a:function(){return n.a}});var n=r(2096)},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:u="",children:c,iconNode:d,...f}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:o?24*Number(l)/Number(a):l,className:s("lucide",u),...f},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:o,...u}=r;return(0,n.createElement)(l,{ref:i,iconNode:t,className:s("lucide-".concat(a(e)),o),...u})});return r.displayName="".concat(e),r}},8575:function(e,t,r){"use strict";r.d(t,{F:function(){return s},e:function(){return i}});var n=r(2265);function a(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function s(...e){return t=>{let r=!1,n=e.map(e=>{let n=a(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():a(e[t],null)}}}}function i(...e){return n.useCallback(s(...e),e)}},7053:function(e,t,r){"use strict";r.d(t,{Z8:function(){return c},g7:function(){return d}});var n,a=r(2265),s=r(8575),i=r(7437),l=Symbol.for("react.lazy"),o=(n||(n=r.t(a,2)))[" use ".trim().toString()];function u(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===l&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}function c(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:r,...n}=e;if(u(r)&&"function"==typeof o&&(r=o(r._payload)),a.isValidElement(r)){var i;let e,l;let o=(i=r,(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.props.ref:i.props.ref||i.ref),u=function(e,t){let r={...t};for(let n in t){let a=e[n],s=t[n];/^on[A-Z]/.test(n)?a&&s?r[n]=(...e)=>{let t=s(...e);return a(...e),t}:a&&(r[n]=a):"style"===n?r[n]={...a,...s}:"className"===n&&(r[n]=[a,s].filter(Boolean).join(" "))}return{...e,...r}}(n,r.props);return r.type!==a.Fragment&&(u.ref=t?(0,s.F)(t,o):o),a.cloneElement(r,u)}return a.Children.count(r)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=a.forwardRef((e,r)=>{let{children:n,...s}=e;u(n)&&"function"==typeof o&&(n=o(n._payload));let l=a.Children.toArray(n),c=l.find(m);if(c){let e=c.props.children,n=l.map(t=>t!==c?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...s,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,n):null})}return(0,i.jsx)(t,{...s,ref:r,children:n})});return r.displayName=`${e}.Slot`,r}var d=c("Slot"),f=Symbol("radix.slottable");function m(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===f}},535:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var n=r(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=n.W,i=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:l}=t,o=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],n=null==l?void 0:l[e];if(null===t)return null;let s=a(t)||a(n);return i[e][s]}),u=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,o,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...u}[t]):({...l,...u})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[358,139,137,943,972,287,971,117,744],function(){return e(e.s=800)}),_N_E=e.O()}]);