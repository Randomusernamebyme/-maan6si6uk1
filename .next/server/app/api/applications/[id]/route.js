"use strict";(()=>{var e={};e.id=689,e.ids=[689],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},74822:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>E,staticGenerationAsyncStorage:()=>d});var n=r(49303),a=r(88716),s=r(60670),o=r(47466),p=e([o]);o=(p.then?(await p)():p)[0];let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/applications/[id]/route",pathname:"/api/applications/[id]",filename:"route",bundlePath:"app/api/applications/[id]/route"},resolvedPagePath:"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\api\\applications\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:E}=c,A="/api/applications/[id]/route";function u(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:d})}i()}catch(e){i(e)}})},47466:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{DELETE:()=>u,PATCH:()=>c});var n=r(87070),a=r(52099),s=e([a]);async function o(e){let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return null;let r=t.split("Bearer ")[1];try{let e=(0,a.Dh)();return await e.verifyIdToken(r)}catch(e){return null}}async function p(e){let t=await o(e);if(!t)return null;let r=(0,a._B)(),i=await r.collection("users").doc(t.uid).get();return i.exists&&i.data()?.role==="admin"?t:null}async function u(e,{params:t}){try{let r=await o(e);if(!r)return n.NextResponse.json({error:"未授權，請先登入"},{status:401});let i=(0,a._B)().collection("applications").doc(t.id),s=await i.get();if(!s.exists)return n.NextResponse.json({error:"報名記錄不存在"},{status:404});let u=s.data(),c=await p(e);if(!c&&u?.volunteerId!==r.uid)return n.NextResponse.json({error:"無權限"},{status:403});if(u?.status!=="pending"&&!c)return n.NextResponse.json({error:"只能撤回待處理狀態的報名"},{status:400});return await i.delete(),n.NextResponse.json({success:!0},{status:200})}catch(e){return console.error("Error deleting application:",e),n.NextResponse.json({error:e.message||"撤回失敗，請稍後再試"},{status:500})}}async function c(e,{params:t}){try{if(!await p(e))return n.NextResponse.json({error:"未授權，需要管理員權限"},{status:401});let r=await e.json(),i=(0,a._B)().collection("applications").doc(t.id);return await i.update({...r,updatedAt:new Date}),n.NextResponse.json({success:!0})}catch(e){return console.error("Error updating application:",e),n.NextResponse.json({error:e.message||"更新失敗，請稍後再試"},{status:500})}}a=(s.then?(await s)():s)[0],i()}catch(e){i(e)}})},52099:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{Dh:()=>l,_B:()=>d});var n=r(3263),a=r(79637),s=r(72929),o=r(55315),p=r(92048),u=e([n,a,s]);[n,a,s]=u.then?(await u)():u;let E=null,A=null,m=null;function c(){if(E&&A&&m)return{adminApp:E,adminAuth:A,adminDb:m};if((0,n.getApps)().length>0){let e=(0,n.getApps)()[0];return E=e,A=(0,a.getAuth)(e),m=(0,s.getFirestore)(e),{adminApp:E,adminAuth:A,adminDb:m}}if("1"!==process.env.VERCEL){let e=(0,o.join)(process.cwd(),"maan6si6uk1-firebase-adminsdk-fbsvc-76e70ff62f.json");if((0,p.existsSync)(e))try{let t=JSON.parse((0,p.readFileSync)(e,"utf8"));return E=(0,n.initializeApp)({credential:(0,n.cert)(t)}),A=(0,a.getAuth)(E),m=(0,s.getFirestore)(E),{adminApp:E,adminAuth:A,adminDb:m}}catch(e){console.warn("無法讀取 JSON 文件，嘗試使用環境變數:",e)}}let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY;if(!e)throw Error("Firebase Admin SDK 配置不完整：缺少 FIREBASE_ADMIN_PRIVATE_KEY");let t=e.trim();if(!(t=(t=(t=(t=(t=(t=t.replace(/^["']|["']$/g,"")).replace(/\\\\n/g,"\n")).replace(/\\n/g,"\n")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n").map(e=>e.trim()).filter(e=>e.length>0).join("\n")).includes("BEGIN PRIVATE KEY")&&!t.includes("BEGIN RSA PRIVATE KEY"))throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN PRIVATE KEY 或 BEGIN RSA PRIVATE KEY");let r=t.includes("BEGIN PRIVATE KEY")||t.includes("BEGIN RSA PRIVATE KEY"),i=t.includes("END PRIVATE KEY")||t.includes("END RSA PRIVATE KEY");if(!r||!i)throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN 或 END 標記");let u=t.match(/(BEGIN (?:RSA )?PRIVATE KEY)/),c=t.match(/(END (?:RSA )?PRIVATE KEY)/);if(!u||!c)throw Error("Firebase Admin SDK private key 格式不正確：無法找到 BEGIN 或 END 標記");let l=u.index+u[0].length,d=c.index;if(d<=l)throw Error("Firebase Admin SDK private key 格式不正確：BEGIN 和 END 之間沒有內容");let I=t.substring(l,d).trim();if(0===I.length)throw Error("Firebase Admin SDK private key 格式不正確：私鑰內容為空");if(!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin SDK 配置不完整：缺少 PROJECT_ID 或 CLIENT_EMAIL");let h={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:t};return E=(0,n.initializeApp)({credential:(0,n.cert)(h),projectId:process.env.FIREBASE_ADMIN_PROJECT_ID}),A=(0,a.getAuth)(E),m=(0,s.getFirestore)(E),{adminApp:E,adminAuth:A,adminDb:m}}function l(){return c().adminAuth}function d(){return c().adminDb}i()}catch(e){i(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972],()=>r(74822));module.exports=i})();