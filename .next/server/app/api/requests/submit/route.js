"use strict";(()=>{var e={};e.id=695,e.ids=[695],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},18809:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>u,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>l,staticGenerationAsyncStorage:()=>E});var s=t(49303),n=t(88716),a=t(60670),o=t(76352),p=e([o]);o=(p.then?(await p)():p)[0];let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/requests/submit/route",pathname:"/api/requests/submit",filename:"route",bundlePath:"app/api/requests/submit/route"},resolvedPagePath:"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\api\\requests\\submit\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:E,serverHooks:l}=d,A="/api/requests/submit/route";function u(){return(0,a.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:E})}i()}catch(e){i(e)}})},76352:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{POST:()=>o});var s=t(87070),n=t(52099),a=e([n]);async function o(e){try{let r=await e.json();if(!r.requester?.name||!r.requester?.phone||!r.requester?.age||!r.requester?.district||!r.description||!r.fields||0===r.fields.length)return s.NextResponse.json({error:"缺少必要欄位"},{status:400});let t={requester:{name:r.requester.name,phone:r.requester.phone,age:r.requester.age,district:r.requester.district},description:r.description,fields:r.fields,appreciation:r.appreciation,status:"pending"},i=(0,n._B)(),a=await i.collection("requests").add({...t,createdAt:new Date,updatedAt:new Date}),o=a.id.substring(0,8).toUpperCase();return s.NextResponse.json({success:!0,id:a.id,trackingNumber:o},{status:201})}catch(e){return console.error("Error submitting request:",e),s.NextResponse.json({error:e.message||"提交失敗，請稍後再試"},{status:500})}}n=(a.then?(await a)():a)[0],i()}catch(e){i(e)}})},52099:(e,r,t)=>{t.a(e,async(e,i)=>{try{t.d(r,{Dh:()=>c,_B:()=>E});var s=t(3263),n=t(79637),a=t(72929),o=t(55315),p=t(92048),u=e([s,n,a]);[s,n,a]=u.then?(await u)():u;let l=null,A=null,m=null;function d(){if(l&&A&&m)return{adminApp:l,adminAuth:A,adminDb:m};if((0,s.getApps)().length>0){let e=(0,s.getApps)()[0];return l=e,A=(0,n.getAuth)(e),m=(0,a.getFirestore)(e),{adminApp:l,adminAuth:A,adminDb:m}}if("1"!==process.env.VERCEL){let e=(0,o.join)(process.cwd(),"maan6si6uk1-firebase-adminsdk-fbsvc-76e70ff62f.json");if((0,p.existsSync)(e))try{let r=JSON.parse((0,p.readFileSync)(e,"utf8"));return l=(0,s.initializeApp)({credential:(0,s.cert)(r)}),A=(0,n.getAuth)(l),m=(0,a.getFirestore)(l),{adminApp:l,adminAuth:A,adminDb:m}}catch(e){console.warn("無法讀取 JSON 文件，嘗試使用環境變數:",e)}}let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY;if(!e)throw Error("Firebase Admin SDK 配置不完整：缺少 FIREBASE_ADMIN_PRIVATE_KEY");let r=e.trim();if(!(r=(r=(r=(r=(r=(r=r.replace(/^["']|["']$/g,"")).replace(/\\\\n/g,"\n")).replace(/\\n/g,"\n")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n").map(e=>e.trim()).filter(e=>e.length>0).join("\n")).includes("BEGIN PRIVATE KEY")&&!r.includes("BEGIN RSA PRIVATE KEY"))throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN PRIVATE KEY 或 BEGIN RSA PRIVATE KEY");let t=r.includes("BEGIN PRIVATE KEY")||r.includes("BEGIN RSA PRIVATE KEY"),i=r.includes("END PRIVATE KEY")||r.includes("END RSA PRIVATE KEY");if(!t||!i)throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN 或 END 標記");let u=r.match(/(BEGIN (?:RSA )?PRIVATE KEY)/),d=r.match(/(END (?:RSA )?PRIVATE KEY)/);if(!u||!d)throw Error("Firebase Admin SDK private key 格式不正確：無法找到 BEGIN 或 END 標記");let c=u.index+u[0].length,E=d.index;if(E<=c)throw Error("Firebase Admin SDK private key 格式不正確：BEGIN 和 END 之間沒有內容");let I=r.substring(c,E).trim();if(0===I.length)throw Error("Firebase Admin SDK private key 格式不正確：私鑰內容為空");if(!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin SDK 配置不完整：缺少 PROJECT_ID 或 CLIENT_EMAIL");let h={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:r};return l=(0,s.initializeApp)({credential:(0,s.cert)(h),projectId:process.env.FIREBASE_ADMIN_PROJECT_ID}),A=(0,n.getAuth)(l),m=(0,a.getFirestore)(l),{adminApp:l,adminAuth:A,adminDb:m}}function c(){return d().adminAuth}function E(){return d().adminDb}i()}catch(e){i(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[276,972],()=>t(18809));module.exports=i})();