"use strict";(()=>{var e={};e.id=322,e.ids=[322],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},77097:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>p,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>E,staticGenerationAsyncStorage:()=>l});var i=t(49303),a=t(88716),s=t(60670),o=t(19107),u=e([o]);o=(u.then?(await u)():u)[0];let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/volunteers/[id]/route",pathname:"/api/admin/volunteers/[id]",filename:"route",bundlePath:"app/api/admin/volunteers/[id]/route"},resolvedPagePath:"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\api\\admin\\volunteers\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:E}=d,A="/api/admin/volunteers/[id]/route";function p(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:l})}n()}catch(e){n(e)}})},19107:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{GET:()=>u,PATCH:()=>p});var i=t(87070),a=t(52099),s=e([a]);async function o(e){let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return null;let t=r.split("Bearer ")[1];try{let e=(0,a.Dh)(),r=await e.verifyIdToken(t),n=(0,a._B)(),i=await n.collection("users").doc(r.uid).get();if(!i.exists||i.data()?.role!=="admin")return null;return r}catch(e){return null}}async function u(e,{params:r}){try{if(!await o(e))return i.NextResponse.json({error:"未授權，需要管理員權限"},{status:401});let t=(0,a._B)(),n=await t.collection("users").doc(r.id).get();if(!n.exists)return i.NextResponse.json({error:"義工不存在"},{status:404});return i.NextResponse.json({id:n.id,...n.data()})}catch(e){return console.error("Error fetching volunteer:",e),i.NextResponse.json({error:e.message||"獲取義工詳情失敗"},{status:500})}}async function p(e,{params:r}){try{if(!await o(e))return i.NextResponse.json({error:"未授權，需要管理員權限"},{status:401});let t=await e.json(),n=(0,a._B)().collection("users").doc(r.id);return await n.update({...t,updatedAt:new Date}),i.NextResponse.json({success:!0})}catch(e){return console.error("Error updating volunteer:",e),i.NextResponse.json({error:e.message||"更新義工資料失敗"},{status:500})}}a=(s.then?(await s)():s)[0],n()}catch(e){n(e)}})},52099:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{Dh:()=>c,_B:()=>l});var i=t(3263),a=t(79637),s=t(72929),o=t(55315),u=t(92048),p=e([i,a,s]);[i,a,s]=p.then?(await p)():p;let E=null,A=null,m=null;function d(){if(E&&A&&m)return{adminApp:E,adminAuth:A,adminDb:m};if((0,i.getApps)().length>0){let e=(0,i.getApps)()[0];return E=e,A=(0,a.getAuth)(e),m=(0,s.getFirestore)(e),{adminApp:E,adminAuth:A,adminDb:m}}if("1"!==process.env.VERCEL){let e=(0,o.join)(process.cwd(),"maan6si6uk1-firebase-adminsdk-fbsvc-76e70ff62f.json");if((0,u.existsSync)(e))try{let r=JSON.parse((0,u.readFileSync)(e,"utf8"));return E=(0,i.initializeApp)({credential:(0,i.cert)(r)}),A=(0,a.getAuth)(E),m=(0,s.getFirestore)(E),{adminApp:E,adminAuth:A,adminDb:m}}catch(e){console.warn("無法讀取 JSON 文件，嘗試使用環境變數:",e)}}let e=process.env.FIREBASE_ADMIN_PRIVATE_KEY;if(!e)throw Error("Firebase Admin SDK 配置不完整：缺少 FIREBASE_ADMIN_PRIVATE_KEY");let r=e.trim();if(!(r=(r=(r=(r=(r=(r=r.replace(/^["']|["']$/g,"")).replace(/\\\\n/g,"\n")).replace(/\\n/g,"\n")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).split("\n").map(e=>e.trim()).filter(e=>e.length>0).join("\n")).includes("BEGIN PRIVATE KEY")&&!r.includes("BEGIN RSA PRIVATE KEY"))throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN PRIVATE KEY 或 BEGIN RSA PRIVATE KEY");let t=r.includes("BEGIN PRIVATE KEY")||r.includes("BEGIN RSA PRIVATE KEY"),n=r.includes("END PRIVATE KEY")||r.includes("END RSA PRIVATE KEY");if(!t||!n)throw Error("Firebase Admin SDK private key 格式不正確：缺少 BEGIN 或 END 標記");let p=r.match(/(BEGIN (?:RSA )?PRIVATE KEY)/),d=r.match(/(END (?:RSA )?PRIVATE KEY)/);if(!p||!d)throw Error("Firebase Admin SDK private key 格式不正確：無法找到 BEGIN 或 END 標記");let c=p.index+p[0].length,l=d.index;if(l<=c)throw Error("Firebase Admin SDK private key 格式不正確：BEGIN 和 END 之間沒有內容");let I=r.substring(c,l).trim();if(0===I.length)throw Error("Firebase Admin SDK private key 格式不正確：私鑰內容為空");if(!process.env.FIREBASE_ADMIN_PROJECT_ID||!process.env.FIREBASE_ADMIN_CLIENT_EMAIL)throw Error("Firebase Admin SDK 配置不完整：缺少 PROJECT_ID 或 CLIENT_EMAIL");let h={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL,privateKey:r};return E=(0,i.initializeApp)({credential:(0,i.cert)(h),projectId:process.env.FIREBASE_ADMIN_PROJECT_ID}),A=(0,a.getAuth)(E),m=(0,s.getFirestore)(E),{adminApp:E,adminAuth:A,adminDb:m}}function c(){return d().adminAuth}function l(){return d().adminDb}n()}catch(e){n(e)}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[276,972],()=>t(77097));module.exports=n})();