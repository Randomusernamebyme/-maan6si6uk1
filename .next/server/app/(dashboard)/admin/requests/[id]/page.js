(()=>{var e={};e.id=902,e.ids=[902],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},65975:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>o}),r(70631),r(17050),r(68032),r(35866),r(83733);var t=r(23191),i=r(88716),a=r(37922),n=r.n(a),l=r(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(s,d);let o=["",{children:["(dashboard)",{children:["admin",{children:["requests",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,70631)),"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\(dashboard)\\admin\\requests\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,17050)),"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\(dashboard)\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,68032)),"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,83733)),"C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\annie\\OneDrive\\Desktop\\maan6si6uk1\\app\\(dashboard)\\admin\\requests\\[id]\\page.tsx"],u="/(dashboard)/admin/requests/[id]/page",x={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(dashboard)/admin/requests/[id]/page",pathname:"/admin/requests/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},68555:(e,s,r)=>{Promise.resolve().then(r.bind(r,26711))},90099:(e,s,r)=>{Promise.resolve().then(r.bind(r,98182))},26711:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o});var t=r(10326),i=r(46132),a=r(37859),n=r(90434),l=r(35047),d=r(77863);function o({children:e}){let{user:s,loading:r}=(0,i.Q)("admin"),o=(0,l.usePathname)();return r?t.jsx(a.h,{}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold",children:"管理後台"}),s&&(0,t.jsxs)("p",{className:"text-muted-foreground mt-2",children:["歡迎，",s.displayName,"！"]})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[t.jsx("aside",{className:"w-full md:w-64 flex-shrink-0",children:t.jsx("nav",{className:"space-y-1",children:[{href:"/admin",label:"儀表板"},{href:"/admin/requests",label:"委托管理"},{href:"/admin/volunteers",label:"義工管理"},{href:"/admin/applications",label:"報名管理"},{href:"/admin/logs",label:"操作日誌"},{href:"/admin/export",label:"數據匯出"}].map(e=>{let s=o===e.href||"/admin"!==e.href&&o.startsWith(e.href);return t.jsx(n.default,{href:e.href,className:(0,d.cn)("flex items-center px-4 py-2 rounded-md text-sm font-medium transition-colors",s?"bg-foreground text-background":"text-foreground/60 hover:bg-muted hover:text-foreground"),children:e.label},e.href)})})}),t.jsx("main",{className:"flex-1 min-w-0",children:e})]})]})}},98182:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>y});var t=r(10326),i=r(17577),a=r(35047),n=r(24211),l=r(33071),d=r(90772),o=r(567),c=r(37859),u=r(93415),x=r(20891),m=r(23424),p=r(72350),h=r(54432),f=r(31048),j=r(77863);let v=i.forwardRef(({className:e,...s},r)=>t.jsx("textarea",{className:(0,j.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...s}));async function g(e,s,r,t,i){try{let a=await (0,n.b)();if(!a)throw Error("請先登入");let l=await fetch("/api/admin/logs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({action:e,targetType:s,targetId:r,description:t,changes:i})});if(!l.ok){let e=await l.json();throw Error(e.error||"創建操作日誌失敗")}return await l.json()}catch(e){console.error("Error creating activity log:",e)}}v.displayName="Textarea";let b={pending:"待審核",open:"已批准",published:"已發布",matched:"已配對","in-progress":"進行中",completed:"已完成",cancelled:"已取消"};function y(){let e=(0,a.useParams)(),s=(0,a.useRouter)(),r=e.id,[j,y]=(0,i.useState)(null),[N,w]=(0,i.useState)(!0),[q,k]=(0,i.useState)(""),[_,C]=(0,i.useState)(!1),[P,D]=(0,i.useState)(!1),[O,U]=(0,i.useState)(""),[z,A]=(0,i.useState)(""),S=async e=>{try{let t=await (0,n.b)();if(!t)throw Error("請先登入");let i=await fetch(`/api/admin/requests/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({status:e})});if(!i.ok){let e=await i.json();throw Error(e.error||"更新失敗")}await g("update_request_status","request",r,`將委托狀態從 ${j?.status} 更改為 ${e}`,{oldStatus:j?.status,newStatus:e}),s.refresh(),window.location.reload()}catch(e){k(e.message||"更新失敗")}},E=async()=>{if(!O.trim()||!z.trim()){k("請填寫聯絡方式和記錄內容");return}try{let e=await (0,n.b)();if(!e)throw Error("請先登入");let t=j?.followUps||[],i={date:new Date,method:O.trim(),content:z.trim(),adminId:""},a=await fetch(`/api/admin/requests/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({followUps:[...t,i]})});if(!a.ok){let e=await a.json();throw Error(e.error||"添加跟進記錄失敗")}D(!1),U(""),A(""),s.refresh(),window.location.reload()}catch(e){k(e.message||"添加跟進記錄失敗")}},T=e=>(0,x.WU)(e,"yyyy年MM月dd日 HH:mm",{locale:m.c});return N?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(c.g,{size:"lg"})}):q&&!j?t.jsx(u.X,{message:q}):j?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"委托詳情"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["編號：",j.id.substring(0,8)]})]}),t.jsx(d.z,{variant:"outline",onClick:()=>s.back(),children:"返回列表"})]}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,t.jsxs)(l.Zb,{children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"基本資料"})}),(0,t.jsxs)(l.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"描述"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1 whitespace-pre-wrap",children:j.description})]}),(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"領域"}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:j.fields.map(e=>t.jsx(o.C,{variant:"secondary",children:e},e))})]}),j.urgency&&(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"緊急程度"}),t.jsx(o.C,{variant:"urgent"===j.urgency?"destructive":"default",className:"mt-1",children:"urgent"===j.urgency?"緊急":"一般"})]}),j.serviceType&&(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"服務形式"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.serviceType})]}),j.estimatedDuration&&(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"預計時長"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.estimatedDuration})]})]})]}),(0,t.jsxs)(l.Zb,{children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"委托者資料（敏感）"})}),(0,t.jsxs)(l.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"姓名"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.requester.name})]}),(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"電話"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.requester.phone})]}),(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"年齡"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.requester.age})]}),(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"居住地區"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.requester.district})]})]})]}),(0,t.jsxs)(l.Zb,{children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"狀態時間線"})}),(0,t.jsxs)(l.aY,{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"text-sm",children:[t.jsx("span",{className:"font-semibold",children:"提交："}),t.jsx("span",{className:"text-muted-foreground ml-2",children:T(j.createdAt)})]}),j.matchedAt&&(0,t.jsxs)("div",{className:"text-sm",children:[t.jsx("span",{className:"font-semibold",children:"配對："}),t.jsx("span",{className:"text-muted-foreground ml-2",children:T(j.matchedAt)})]}),j.completedAt&&(0,t.jsxs)("div",{className:"text-sm",children:[t.jsx("span",{className:"font-semibold",children:"完成："}),t.jsx("span",{className:"text-muted-foreground ml-2",children:T(j.completedAt)})]})]})]}),j.followUps&&j.followUps.length>0&&(0,t.jsxs)(l.Zb,{children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"跟進記錄"})}),t.jsx(l.aY,{className:"space-y-4",children:j.followUps.map((e,s)=>(0,t.jsxs)("div",{className:"border-l-2 pl-4 py-2",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:T(e.date instanceof Date?e.date:new Date(e.date))}),t.jsx("div",{className:"text-sm font-semibold mt-1",children:e.method}),t.jsx("div",{className:"text-sm mt-1",children:e.content})]},s))})]})]}),t.jsx("div",{className:"space-y-6",children:(0,t.jsxs)(l.Zb,{children:[t.jsx(l.Ol,{children:t.jsx(l.ll,{children:"操作面板"})}),(0,t.jsxs)(l.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[t.jsx(f._,{children:"當前狀態"}),t.jsx(o.C,{variant:"pending"===j.status?"outline":"completed"===j.status?"secondary":"cancelled"===j.status?"destructive":"default",className:"mt-2 block w-fit",children:b[j.status]||j.status})]}),"pending"===j.status&&(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(d.z,{onClick:()=>S("open"),className:"w-full",children:"批准"}),t.jsx(d.z,{onClick:()=>S("cancelled"),variant:"destructive",className:"w-full",children:"拒絕"})]}),"open"===j.status&&t.jsx("div",{className:"space-y-2",children:t.jsx(d.z,{onClick:()=>S("published"),className:"w-full",children:"發布給義工"})}),"published"===j.status&&t.jsx("div",{className:"space-y-2",children:t.jsx(d.z,{onClick:()=>S("in-progress"),className:"w-full",children:"標記為進行中"})}),"in-progress"===j.status&&(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(d.z,{onClick:()=>S("completed"),className:"w-full",children:"標記為已完成"}),t.jsx(d.z,{onClick:()=>S("cancelled"),variant:"destructive",className:"w-full",children:"取消"})]}),t.jsx("div",{className:"pt-4 border-t",children:t.jsx(d.z,{onClick:()=>D(!0),variant:"outline",className:"w-full",children:"添加跟進記錄"})})]})]})})]}),t.jsx(p.Vq,{open:P,onOpenChange:D,children:(0,t.jsxs)(p.cZ,{children:[(0,t.jsxs)(p.fK,{children:[t.jsx(p.$N,{children:"添加跟進記錄"}),t.jsx(p.Be,{children:"記錄與委托者的聯絡情況"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(f._,{htmlFor:"followUpMethod",children:"聯絡方式"}),t.jsx(h.I,{id:"followUpMethod",value:O,onChange:e=>U(e.target.value),placeholder:"例如：電話、WhatsApp、上門"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(f._,{htmlFor:"followUpContent",children:"記錄內容"}),t.jsx(v,{id:"followUpContent",value:z,onChange:e=>A(e.target.value),placeholder:"請輸入跟進記錄...",rows:4})]})]}),(0,t.jsxs)(p.cN,{children:[t.jsx(d.z,{variant:"outline",onClick:()=>D(!1),children:"取消"}),t.jsx(d.z,{onClick:E,children:"確認"})]})]})})]}):t.jsx(u.X,{message:"委托不存在"})}},567:(e,s,r)=>{"use strict";r.d(s,{C:()=>l});var t=r(10326);r(17577);var i=r(79360),a=r(77863);let n=(0,i.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...r}){return t.jsx("div",{className:(0,a.cn)(n({variant:s}),e),...r})}},54432:(e,s,r)=>{"use strict";r.d(s,{I:()=>n});var t=r(10326),i=r(17577),a=r(77863);let n=i.forwardRef(({className:e,type:s,...r},i)=>t.jsx("input",{type:s,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:i,...r}));n.displayName="Input"},31048:(e,s,r)=>{"use strict";r.d(s,{_:()=>o});var t=r(10326),i=r(17577),a=r(29152),n=r(79360),l=r(77863);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=i.forwardRef(({className:e,...s},r)=>t.jsx(a.f,{ref:r,className:(0,l.cn)(d(),e),...s}));o.displayName=a.f.displayName},24211:(e,s,r)=>{"use strict";r.d(s,{b:()=>i});var t=r(72824);async function i(){let e=t.I.currentUser;if(!e)return null;try{return await e.getIdToken()}catch(e){return console.error("Error getting auth token:",e),null}}},17050:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`C:\Users\annie\OneDrive\Desktop\maan6si6uk1\app\(dashboard)\admin\layout.tsx#default`)},70631:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`C:\Users\annie\OneDrive\Desktop\maan6si6uk1\app\(dashboard)\admin\requests\[id]\page.tsx#default`)},29152:(e,s,r)=>{"use strict";r.d(s,{f:()=>d});var t=r(17577);r(60962);var i=r(34214),a=r(10326),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let r=(0,i.Z8)(`Primitive.${s}`),n=t.forwardRef((e,t)=>{let{asChild:i,...n}=e,l=i?r:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(l,{...n,ref:t})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{}),l=t.forwardRef((e,s)=>(0,a.jsx)(n.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));l.displayName="Label";var d=l}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,730,454,680,594],()=>r(65975));module.exports=t})();